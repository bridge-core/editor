<template>
	<div class="w-full h-full">
		<div class="w-full h-8 flex gap-4 mb-2">
			<div
				v-for="tab in instance.tabs.value"
				class="flex items-center gap-1 p-2 rounded cursor-pointer"
				:style="{
					background:
						instance.selectedTab.value == tab ? 'var(--theme-color-backgroundSecondary)' : 'transparent',
				}"
				@click="() => instance.selectTab(tab)"
			>
				<span class="relative">
					<div
						v-if="tab instanceof FileTab && tab.modified.value"
						class="bg-behaviorPack border border-[2px] border-[var(--border-color)] w-3 h-3 rounded-full absolute right-[-0.25rem] top-1"
						:style="{
							'--border-color':
								instance.selectedTab.value == tab
									? 'var(--theme-color-backgroundSecondary)'
									: 'transparent',
						}"
					></div>

					<Icon v-if="tab.icon" :icon="tab.icon.value ?? 'help'" class="text-base text-behaviorPack" />
				</span>

				<span class="font-inter select-none">{{ tab.name.value ?? 'Tab' }}</span>

				<IconButton icon="close" class="text-base" @click.stop="() => instance.removeTab(tab)" />
			</div>
		</div>

		<div class="w-full tab-content">
			<component
				v-if="instance.selectedTab.value"
				:instance="instance.selectedTab.value"
				:is="instance.selectedTab.value.component"
				:key="instance.selectedTab.value.id"
			/>
		</div>
	</div>
</template>

<script setup lang="ts">
import Icon from '@/components/Common/Icon.vue'
import IconButton from '@/components/Common/IconButton.vue'

import { TabSystem } from './TabSystem'
import { FileTab } from './FileTab'

defineProps({
	instance: {
		type: TabSystem,
		required: true,
	},
})
</script>

<style scoped>
.tab-content {
	height: calc(100% - 2.5rem - 0.5rem);
}
</style>
